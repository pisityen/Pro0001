<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IT Support</title>
    <link rel="stylesheet" href="/css/bar.css" />
    <link rel="stylesheet" href="/css/styles.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>


    <!--LINK JQUERY-->

  </head>
  <body>
    <div class="main-container">
      <!-- Sidebar -->
      <div class="sidebar bg-dark text-white vh-100 d-flex flex-column" id="side_nav">
        <!-- ‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏ô Sidebar -->
        <div class="header-box px-3 pt-3 pb-4 d-flex justify-content-between align-items-center">
          <h1 class="fs-5 text-uppercase">
            <span class="bg-white text-dark rounded shadow px-2 me-2">IT</span>
            <span class="text-white">Management</span>
          </h1>
        </div>
        <ul class="list-unstyled px-2">
          <li class="mb-2">
            <% if (role === 'admin') { %><a href="/dashboard" class="text-decoration-none px-3 py-3 d-block rounded text-white active-link">Dashboard</a><% } %>
          </li>
          <% if (role === 'admin') { %><li class="mb-2"><a href="/asset_management" class="text-decoration-none px-3 py-3 d-block rounded text-white active-link">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</a></li><% } %>
          <li class="mb-2"><a href="/asset_requests" class="text-decoration-none px-3 py-3 d-block rounded text-white active-link">‡πÄ‡∏ö‡∏¥‡∏Å‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</a></li>
          <li class="mb-2"><a href="/all_transfers" class="text-decoration-none px-3 py-3 d-block rounded text-white active-link">‡πÇ‡∏≠‡∏ô‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô</a></li>
            <% if (role === 'admin') { %><a href="/account" class="text-decoration-none px-3 py-3 d-block rounded text-white active-link">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</a><% } %></li>
        </ul>
        <div class="mt-auto px-2 pb-3 text-center">
          <div class="text-white mb-2">
            User : <%= user_name %>
          </div>
          <div class="text-white mb-2">
            Role : <%= role %>
          </div>
          <a href="/logout" class="btn btn-danger text-decoration-none px-3 py-2 w-100">
            <i class="fas fa-sign-out-alt me-2"></i> Logout
          </a>
        </div>
      </div>
  
        <!-- //‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏´‡∏•‡∏±‡∏Å// -->
         <div class="container mt-5">
        
          <h2 class="mb-4">üìä Asset Transfer Dashboard</h2>

          <!-- Section 1: Summary Statistics -->
          <div class="row text-center mb-4">
            <div class="col-md-3">
              <div class="card bg-light">
                <div class="card-body">
                  <h5>üì¶ ‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å</h5>
                    <h3><%= stats.requestCount %></h3>
                </div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="card bg-light">
                <div class="card-body">
                  <h5>‚ôªÔ∏è ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô</h5>
                  <h3><%= stats.returnCount %></h3>
                </div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="card bg-light">
                <div class="card-body">
                  <h5>‚è≥ Pending</h5>
                  <h3><%= stats.pendingCount %></h3>
                </div>
              </div>
            </div>
            <div class="col-md-3">
              <div class="card bg-light">
                <div class="card-body">
                  <h5>üî¢ ‡∏ó‡∏£‡∏±‡∏û‡∏¢‡πå‡∏™‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h5>
                  <h3><%= stats.assetCount %></h3>
                </div>
              </div>
            </div>
          </div>

          <!-- Section 2: Latest Transfers -->
          <div class="row mb-4">
            <div class="col-md-6">
              <h5>üÜï 5 ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h5>
              <ul class="list-group">
                <% latestTransfers.forEach(t => { %>
                  <li class="list-group-item">
                    <strong><%= t.transfer_number %></strong> - <strong>Type</strong> <%= t.transfer_type %> - <strong>Date</strong> <%= new Date(t.transfer_date).toLocaleDateString('en-GB', { 
                          year: 'numeric', 
                          month: '2-digit', 
                          day: '2-digit'
                          }) 
                          %>
                          - <strong>Status</strong> <%= t.at_status %>
                    <br>‡πÇ‡∏î‡∏¢ <%= t.created_by_name %>
                  </li>
                <% }) %>
              </ul>
            </div>
            <div class="col-md-6">
              <h5>üÜï 5 ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</h5>
              <ul class="list-group">
                <% latestReturns.forEach(t => { %>
                  <li class="list-group-item">
                    <strong><%= t.transfer_number %></strong> - <%= new Date(t.transfer_date).toLocaleDateString('en-GB', { 
                          year: 'numeric', 
                          month: '2-digit', 
                          day: '2-digit'
                          }) 
                          %>
                    <br>‡πÇ‡∏î‡∏¢ <%= t.created_by_name %>
                  </li>
                <% }) %>
              </ul>
            </div>
          </div>

          <!-- Section 3: Charts
          <div class="row mb-5">
            <div class="col-md-6">
              <canvas id="typePieChart"></canvas>
            </div>
            <div class="col-md-6">
              <canvas id="monthlyBarChart"></canvas>
            </div>
          </div> -->

          <!-- Section 4: Pending -->
          <h5>üõë ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</h5>
          <table class="table table-bordered">
            <thead>
              <tr>
                <th>‡πÄ‡∏•‡∏Ç‡πÉ‡∏ö‡πÇ‡∏≠‡∏ô</th>
                <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
                <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th>
                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                <th>‡πÇ‡∏î‡∏¢</th>
              </tr>
            </thead>
            <tbody>
              <% pendingTransfers.forEach(p => { %>
                <tr>
                  <td><%= p.transfer_number %></td>
                  <td><%= p.transfer_type %></td>
                  <td><%= new Date(p.transfer_date).toLocaleDateString('en-GB', { 
                          year: 'numeric', 
                          month: '2-digit', 
                          day: '2-digit'
                          }) 
                          %>
                  <td><span class="badge bg-warning text-dark"><%= p.at_status %></span></td>
                  <td><%= p.created_by_name %></td>
                </tr>
              <% }) %>
            </tbody>
          </table>
        </div>
      </div>
      

    <script>
      console.log("Stats in JS:", <%- JSON.stringify(stats) %>);
      const pieCtx = document.getElementById('typePieChart').getContext('2d');
        new Chart(pieCtx, {
          type: 'pie',
          data: {
            labels: ['Request', 'Return'],
            datasets: [{
              data: [<%- stats.requestCount %>, <%- stats.returnCount %>],
              backgroundColor: ['#4e73df', '#1cc88a']
            }]
          }
        });

        const barCtx = document.getElementById('monthlyBarChart').getContext('2d');
        new Chart(barCtx, {
          type: 'bar',
          data: {
            labels: <%- JSON.stringify(stats.monthLabels) %>,
            datasets: [
              {
                label: 'Request',
                data: <%- JSON.stringify(stats.monthRequestCounts) %>,
                backgroundColor: '#4e73df'
              },
              {
                label: 'Return',
                data: <%- JSON.stringify(stats.monthReturnCounts) %>,
                backgroundColor: '#1cc88a'
              }
            ]
          }
        });

    </script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="/script.js"></script>
  </body>
  
</html>
