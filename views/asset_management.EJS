<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>IT Support</title>
  <link rel="stylesheet" href="/css/bar.css" />
  <link rel="stylesheet" href="/css/styles.css" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <!--LINK JQUERY-->
</head>

<body>
  <div class="main-container">
      <!-- Sidebar -->
      <div class="sidebar bg-dark text-white vh-100 d-flex flex-column" id="side_nav">
        <!-- ส่วนเนื้อหาใน Sidebar -->
        <div class="header-box px-3 pt-3 pb-4 d-flex justify-content-between align-items-center">
          <h1 class="fs-5 text-uppercase">
            <span class="bg-white text-dark rounded shadow px-2 me-2">IT</span>
            <span class="text-white">Management</span>
          </h1>
        </div>
        <ul class="list-unstyled px-2">
          <li class="mb-2">
          <% if (role === 'admin') { %><a href="/dashboard" class="text-decoration-none px-3 py-3 d-block rounded text-white active-link">Dashboard</a><% } %>
         </li>
          <% if (role === 'admin') { %><li class="mb-2"><a href="/asset_management" class="text-decoration-none px-3 py-3 d-block rounded text-white active-link">ข้อมูลทรัพย์สิน</a></li><% } %>
          <li class="mb-2"><a href="/asset_requests" class="text-decoration-none px-3 py-3 d-block rounded text-white active-link">เบิกทรัพย์สิน</a></li>
          <li class="mb-2"><a href="/all_transfers" class="text-decoration-none px-3 py-3 d-block rounded text-white active-link">โอนทรัพย์สิน</a></li>
            <% if (role === 'admin') { %><a href="/account" class="text-decoration-none px-3 py-3 d-block rounded text-white active-link">ข้อมูลผู้ใช้งาน</a><% } %></li>
        </ul>
        <div class="mt-auto px-2 pb-3 text-center">
          <div class="text-white mb-2">
            User : <%= user_name %>
          </div>
          <div class="text-white mb-2">
            Role : <%= role %>
          </div>
          <a href="/logout" class="btn btn-danger text-decoration-none px-3 py-2 w-100">
            <i class="fas fa-sign-out-alt me-2"></i> Logout
          </a>
        </div>
      </div>
  
        <!-- //หน้าจอหลัก// -->
  <div class="content">
    <div class="dashboard-content px-3 pt-4">
      <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
          <h2 class="navbar-brand fs-5">Asset</h2>
          <!-- ปุ่มสำหรับเพิ่มทรัพย์สิน -->
           <div>
            <a href="/assets/assets/print_qr_select" class="btn btn-danger mx-2" style="float: left">พิมพ์ QR</a>
            <a href="/assets/create" class="btn btn-success">Add New Asset</a>
           </div>
          
        </div>
      </nav>

      <form>
        <div class="row g-3 mb-3">
          <div class="col-md-3">
            <label for="assetNumber" class="form-label">Asset Number</label>
            <input type="text" class="form-control" id="assetNumber" readonly>
          </div>
          <div class="col-md-3">
            <label for="assetName" class="form-label">Asset Name</label>
            <input type="text" class="form-control" id="assetName">
          </div>
          <div class="col-md-3">
            <label for="assetCategory" class="form-label">Category</label>
            <input type="text" class="form-control" id="assetCategory">
          </div>
          <div class="col-md-3">
            <label for="assetSerialNumber" class="form-label">Serial Number</label>
            <input type="text" class="form-control" id="assetSerialNumber">
          </div>
        </div>
      </form>

      <table class="table table-striped table-hover">
        <thead class="table-dark">
          <tr>
            <!-- <th>ID</th> -->
            <th>Asset Number</th>
            <th>Name</th>
            <th>Category</th>
            <th>Serial Number</th>
            <th>Data</th>
            <th>Location</th>
            <th>QRCode</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody class="table-group-divider">
          <% if (assets && assets.length> 0) { %> <% assets.forEach(asset=> { %>
              <tr>
                <!-- <td><%= asset.as_id %></td> -->
                <td>
                  <%= asset.as_asset_number %>
                </td>
                <td>
                  <%= asset.as_name %>
                </td>
                <td>
                  <%= asset.as_category %>
                </td>
                <td>
                  <%= asset.as_serial_number %>
                </td>
                
                <td>
                  <%= new Date(asset.created_at).toLocaleDateString('en-GB', { 
                        year: 'numeric', 
                        month: '2-digit', 
                        day: '2-digit'
                      }) 
                  %>
                </td>
                <td>
                  <%= asset.as_location %>
                </td> 
                <td>
                  <img src="/api/qrcode/<%= asset.as_asset_number %>" width="100">
                </td>

                <td>
                  <!-- ปุ่มแก้ไข -->
                  <a href="/assets/edit/<%= asset.as_id %>" class="btn btn-warning">Edit</a>
                  <!-- <a href="/assets/print_qr/<%= asset.as_asset_number %>" target="_blank">พิมพ์สติ๊กเกอร์</a> -->

                  <!-- ปุ่มลบ -->
                  <form action="/assets/delete/<%= asset.as_id %>" method="POST" style="display: inline">
                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure?')">
                      Delete
                    </button>
                  </form>
                </td>
              </tr>
              <% }) %>
                <% } else { %>
                  <tr>
                    <td colspan="7" class="text-center">No assets found</td>
                  </tr>
                  <% } %>
        </tbody>
      </table>
    </div>
  </div>
  </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <script src="/script.js"></script>
  <script>
    document.querySelector('#addAssetForm').addEventListener('submit', function (e) {
      e.preventDefault(); // ป้องกันการรีเฟรชหน้าเว็บ

      const formData = new FormData(this);

      fetch('/assets/create', {
        method: 'POST',
        body: formData,
      })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            alert(data.message);
            location.reload(); // รีโหลดหน้าเว็บเพื่อแสดงรายการใหม่
          } else {
            alert(data.message || 'Failed to add asset.');
          }
        })
        .catch(err => console.error('Error:', err));
    });

  </script>
</body>

</html>